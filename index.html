<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>G√©n√©rateur d'Attestation - CARADEL SARL</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family:"Times New Roman", serif;
    }

    body{
      background-color:#f5f5f5;
      color:#000;
      line-height:1.4;
      padding:15px;
      max-width:900px;
      margin:0 auto;
      font-size:13px;
    }

    /* Interface de contr√¥le */
    .controls{
      background-color:#fff;
      padding:15px;
      border-radius:6px;
      margin-bottom:20px;
      box-shadow:0 3px 8px rgba(0,0,0,0.08);
      border:1px solid #ddd;
    }

    .logo-control{
      background-color:#f8f9fa;
      padding:12px;
      border-radius:4px;
      margin-bottom:15px;
      border-left:3px solid #0d3b66;
    }

    .form-row{
      display:flex;
      gap:10px;
      margin-bottom:12px;
    }

    .form-col{ flex:1; }

    .form-group{ margin-bottom:10px; }

    label{
      display:block;
      margin-bottom:4px;
      font-weight:bold;
      color:#0d3b66;
      font-size:12px;
    }

    input, select, textarea{
      width:100%;
      padding:7px;
      border:1px solid #ddd;
      border-radius:3px;
      font-size:12px;
      font-family:inherit;
    }

    textarea{
      min-height:70px;
      resize:vertical;
    }

    .button-group{
      display:flex;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }

    button{
      padding:8px 16px;
      border:none;
      border-radius:3px;
      font-size:12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:6px;
      transition:all .3s ease;
      flex:1;
    }

    .print-btn{ background:#0d3b66; color:#fff; }
    .print-btn:hover{ background:#0a2d4d; }
    .reset-btn{ background:#666; color:#fff; }
    .reset-btn:hover{ background:#555; }
    .generate-btn{ background:#2a9d8f; color:#fff; }
    .generate-btn:hover{ background:#24897c; }

    .footer{
      text-align:center;
      margin-top:15px;
      padding-top:12px;
      border-top:1px solid #ddd;
      color:#666;
      font-size:10px;
    }

    .mission-example{
      font-size:10px;
      color:#666;
      margin-top:4px;
      font-style:italic;
    }

    .logo-info{
      font-size:11px;
      color:#666;
      margin-top:8px;
      font-style:italic;
    }

    /* ATTESTATION - A4 */
    .document-container{
      background:#fff;
      padding:30px;
      margin-bottom:20px;
      box-shadow:0 0 10px rgba(0,0,0,0.1);
      position:relative;
      min-height:280mm;
      page-break-inside:avoid;
      width:210mm;
      margin-left:auto;
      margin-right:auto;
    }

    /* LOGO CENTRAL (filigrane) */
    .center-logo{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      z-index:1;
      opacity:0.15;
      pointer-events:none;
      text-align:center;
      width:300px;
      height:300px;
    }
    .center-logo img{
      width:300px;
      height:300px;
      object-fit:contain;
      display:block;
    }

    .letterhead{
      text-align:center;
      border-bottom:2px solid #0d3b66;
      padding-bottom:10px;
      margin-bottom:20px;
      position:relative;
      z-index:10;
      background:#fff;
      padding-top:10px;
    }

    .company-name{
      font-size:20px;
      font-weight:bold;
      color:#0d3b66;
      text-transform:uppercase;
      letter-spacing:1px;
      margin-bottom:3px;
    }

    .company-tagline{
      font-size:11px;
      font-style:italic;
      color:#666;
      margin-bottom:8px;
    }

    .company-details{
      font-size:10px;
      color:#333;
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:10px;
      margin-top:5px;
    }

    .content{
      font-size:13px;
      text-align:justify;
      margin-bottom:15px;
      position:relative;
      z-index:10;
    }

    .attestation-title{
      text-align:center;
      font-size:15px;
      font-weight:bold;
      text-transform:uppercase;
      margin-bottom:25px;
      text-decoration:underline;
      position:relative;
      z-index:10;
    }

    .section{
      margin-bottom:12px;
      position:relative;
      z-index:10;
    }

    .employee-info{
      margin:15px 0;
      padding:12px;
      background:rgba(249,249,249,0.95);
      border-left:3px solid #0d3b66;
      position:relative;
      z-index:10;
    }

    .info-line{ margin-bottom:4px; }

    .mission-list{
      margin:12px 0 15px 20px;
      position:relative;
      z-index:10;
    }

    .mission-list li{
      margin-bottom:5px;
      text-align:justify;
    }

    .signature-section{
      margin-top:40px;
      text-align:right;
      position:relative;
      z-index:10;
    }

    .signature-line{
      display:inline-block;
      width:220px;
      border-bottom:1px solid #000;
      margin-bottom:4px;
    }

    .date-place{
      margin-top:25px;
      text-align:right;
      font-style:italic;
      position:relative;
      z-index:10;
    }

    .stamp{
      position:absolute;
      bottom:70px;
      left:30px;
      width:90px;
      height:90px;
      border:2px dashed #0d3b66;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:.8;
      transform:rotate(-15deg);
      z-index:10;
      background:#fff;
    }

    .stamp-text{
      text-align:center;
      font-weight:bold;
      color:#0d3b66;
      font-size:10px;
      text-transform:uppercase;
      padding:4px;
    }

    /* R√àGLES D'IMPRESSION */
    @media print{
      /* Important : forcer l'impression des couleurs & backgrounds */
      *{
        -webkit-print-color-adjust:exact !important;
        print-color-adjust:exact !important;
      }

      .controls, .footer, button{ display:none !important; }

      body{
        background:#fff !important;
        padding:0 !important;
        margin:0 !important;
        width:210mm !important;
        font-size:12px !important;
      }

      .document-container{
        box-shadow:none !important;
        padding:25px !important;
        margin:0 auto !important;
        border:none !important;
        width:210mm !important;
        height:297mm !important;
        min-height:297mm !important;
        position:relative !important;
        display:block !important;
        page-break-after:always;
      }

      /* logo filigrane : on force l'affichage */
      .center-logo{
        display:block !important;
        visibility:visible !important;
        opacity:0.12 !important;
        z-index:1 !important;
      }

      .letterhead{
        border-bottom:2px solid #000 !important;
        margin-bottom:15px !important;
        padding-bottom:8px !important;
        padding-top:0 !important;
      }

      .employee-info{ background:rgba(249,249,249,0.98) !important; }

      .stamp{
        bottom:60px !important;
        left:25px !important;
      }

      .section, .employee-info, .mission-list{
        page-break-inside:avoid !important;
      }
    }

    @media (max-width:768px){
      body{ padding:10px; }
      .document-container{ padding:20px; width:auto; }
      .form-row{ flex-direction:column; gap:0; }
      .button-group{ flex-direction:column; }
      button{ width:100%; justify-content:center; }
      .stamp{
        position:relative;
        bottom:auto;
        left:auto;
        margin:20px auto;
      }
      .center-logo{ width:200px; height:200px; }
      .center-logo img{ width:200px; height:200px; }
    }
  </style>
</head>

<body>
  <!-- Interface de contr√¥le -->
  <div class="controls">
    <h3><i class="fas fa-edit"></i> Personnaliser l'attestation</h3>

    <!-- SECTION POUR LE LOGO -->
    <div class="logo-control">
      <label for="logoFile">üñºÔ∏è LOGO CENTRAL DANS L'ATTESTATION</label>
      <input type="file" id="logoFile" accept="image/*">
      <p class="logo-info"><strong>IMPORTANT :</strong> Si tu charges une image, le code essaie automatiquement de rendre le fond transparent.</p>
      <p class="logo-info">Formats accept√©s : PNG, JPG, SVG. Taille recommand√©e : 300x300 pixels.</p>

      <div style="margin-top:10px; display:flex; gap:10px;">
        <button id="testLogoBtn" style="background-color:#6c757d;">
          <i class="fas fa-image"></i> Afficher logo CARADEL (PNG)
        </button>
        <button id="removeLogoBtn" style="background-color:#dc3545;">
          <i class="fas fa-times"></i> Cacher le logo
        </button>
      </div>
    </div>

    <!-- Informations du salari√© -->
    <div class="form-row">
      <div class="form-col">
        <div class="form-group">
          <label for="employeeName">Nom et pr√©nom du salari√© *</label>
          <input type="text" id="employeeName" value="NTOUOHOU MAXIME G√âRARD" required>
        </div>
        <div class="form-group">
          <label for="birthDate">Date de naissance *</label>
          <input type="text" id="birthDate" value="23/02/1999" required>
        </div>
        <div class="form-group">
          <label for="poste">Poste occup√© *</label>
          <input type="text" id="poste" value="PLOMBIER" required>
        </div>
      </div>

      <div class="form-col">
        <div class="form-group">
          <label for="genre">Genre du salari√© *</label>
          <select id="genre">
            <option value="homme">Homme</option>
            <option value="femme">Femme</option>
          </select>
        </div>
        <div class="form-group">
          <label for="startDate">Date de d√©but *</label>
          <input type="text" id="startDate" value="01 mars 2020" required>
        </div>
        <div class="form-group">
          <label for="endDate">Date de fin *</label>
          <input type="text" id="endDate" value="31 mai 2025" required>
        </div>
      </div>
    </div>

    <!-- Temps de travail -->
    <div class="form-group">
      <label for="workingTime">Temps de travail *</label>
      <input
        type="text"
        id="workingTime"
        value="huit (08) heures par jour, soit quarante (40) heures par semaine"
        required
      >
      <div class="mission-example">
        Exemple : huit (08) heures par jour, soit quarante (40) heures par semaine
      </div>
    </div>

    <!-- Missions -->
    <div class="form-group">
      <label for="missions">Missions (une par ligne, avec ‚Ä¢ au d√©but)</label>
      <textarea id="missions" class="missions-input">‚Ä¢ Installation des syst√®mes de plomberie
‚Ä¢ Entretien et r√©paration des r√©seaux d'eau
‚Ä¢ D√©tection et r√©paration des fuites
‚Ä¢ Pose d'√©quipements sanitaires
‚Ä¢ Respect des normes de s√©curit√© et de qualit√©</textarea>
      <div class="mission-example">Exemple: ‚Ä¢ Mission 1 ‚Ä¢ Mission 2 (une par ligne)</div>
    </div>

    <!-- Boutons -->
    <div class="button-group">
      <button class="generate-btn" id="generateBtn">
        <i class="fas fa-file-contract"></i> G√©n√©rer l'attestation
      </button>
      <button class="reset-btn" id="resetBtn">
        <i class="fas fa-redo"></i> R√©initialiser
      </button>
      <button class="print-btn" id="printBtn">
        <i class="fas fa-print"></i> G√©n√©rer PDF
      </button>
    </div>
  </div>

  <!-- ATTESTATION -->
  <div class="document-container" id="documentContainer">
    <!-- LOGO CENTRAL -->
    <div class="center-logo" id="centerLogo"></div>

    <!-- Contenu -->
    <div class="letterhead">
      <div class="company-name">CARADEL SARL</div>
      <div class="company-tagline">Une Entreprise au service de tous</div>
      <div class="company-details">
        <div>RC/DSC/2022/B/18</div>
        <div>NIU: M012217028223S</div>
        <div>T√©l: 696 67 15 13</div>
        <div>Dschang-Cameroun</div>
        <div>Email: caradel2020@gmail.com</div>
      </div>
    </div>

    <h1 class="attestation-title">ATTESTATION DE TRAVAIL</h1>

    <div class="content" id="documentContent">
      <div class="section">
        <p>Je soussign√©, <strong>Monsieur NDONGSON LEKANE Barthelemy</strong>,</p>
        <p>agissant en qualit√© de <strong>Directeur</strong>,</p>
        <p>au sein de l'entreprise <strong>CARADEL SARL</strong>,</p>
        <p>situ√©e √† <strong>Dschang, Cameroun</strong>,</p>
      </div>

      <div class="section">
        <p>atteste par la pr√©sente que :</p>
      </div>

      <div class="employee-info">
        <div class="info-line" id="salarieLine">
          <strong><span id="civilite">Monsieur</span> <span id="displayName">NTOUOHOU MAXIME G√âRARD</span></strong>,
        </div>
        <div class="info-line" id="naissanceLine">
          n√©<span id="feminineE"></span> le <span id="displayBirthDate">23/02/1999</span>,
        </div>
        <div class="info-line">
          a √©t√© employ√©<span id="feminineE2"></span> au sein de notre entreprise en qualit√© de
          <strong><span id="displayPoste">PLOMBIER</span></strong>,
        </div>
        <div class="info-line">
          du <span id="displayStartDate">01 mars 2020</span> au <span id="displayEndDate">31 mai 2025</span>.
        </div>

        <div class="info-line">
          travaillait √† raison de <strong><span id="displayWorkingTime">huit (08) heures par jour, soit quarante (40) heures par semaine</span></strong>,
          conform√©ment √† la r√©glementation en vigueur.
        </div>
      </div>

      <div class="section">
        <p>Durant cette p√©riode, <span id="pronoun">il</span> a assur√© notamment les missions suivantes :</p>
        <ul class="mission-list" id="displayMissions">
          <li>Installation des syst√®mes de plomberie</li>
          <li>Entretien et r√©paration des r√©seaux d'eau</li>
          <li>D√©tection et r√©paration des fuites</li>
          <li>Pose d'√©quipements sanitaires</li>
          <li>Respect des normes de s√©curit√© et de qualit√©</li>
        </ul>
      </div>

      <div class="section">
        <p><span id="civilite2">Monsieur</span> <span id="displayName2">NTOUOHOU MAXIME G√âRARD</span> s'est distingu√©<span id="feminineE3"></span> par son s√©rieux, son professionnalisme et la qualit√© de son travail.</p>
      </div>

      <div class="section">
        <p>La pr√©sente attestation est d√©livr√©e pour servir et valoir ce que de droit.</p>
      </div>

      <div class="date-place">
        <p>Fait √† Dschang, le <span id="currentDate">15 novembre 2023</span></p>
      </div>
    </div>

    <div class="signature-section">
      <div class="signature-line"></div>
      <p><strong>Monsieur NDONGSON LEKANE Barthelemy</strong></p>
      <p><strong>Directeur</strong></p>
      <p><strong>CARADEL SARL</strong></p>
    </div>

    <div class="stamp">
      <div class="stamp-text">Cachet<br>de<br>l'entreprise</div>
    </div>
  </div>

  <div class="footer">
    <p>CARADEL SARL - RC/DSC/2022/B/18 - NIU: M012217028223S - T√©l: 696 67 15 13 - Dschang-Cameroun</p>
    <p>G√©n√©rateur d'attestation de travail - Logo visible dans le PDF</p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Date auto
      const now = new Date();
      const options = { day: 'numeric', month: 'long', year: 'numeric' };
      document.getElementById('currentDate').textContent = now.toLocaleDateString('fr-FR', options);

      // Inputs
      const employeeNameInput = document.getElementById('employeeName');
      const birthDateInput = document.getElementById('birthDate');
      const posteInput = document.getElementById('poste');
      const genreInput = document.getElementById('genre');
      const startDateInput = document.getElementById('startDate');
      const endDateInput = document.getElementById('endDate');
      const missionsInput = document.getElementById('missions');
      const workingTimeInput = document.getElementById('workingTime');

      // Logo elements
      const logoFileInput = document.getElementById('logoFile');
      const centerLogo = document.getElementById('centerLogo');
      const testLogoBtn = document.getElementById('testLogoBtn');
      const removeLogoBtn = document.getElementById('removeLogoBtn');
      const printBtn = document.getElementById('printBtn');

      // ‚úÖ LOGO PNG PAR D√âFAUT (mets caradel-logo.png dans le m√™me dossier que ce HTML)
      const defaultLogoPNG = "caradel-logo.png";

      // --- LOGO PRINT SAFE ---
      let printableLogoDataUrl = null;

      function setLogoFromUrl(url) {
        centerLogo.innerHTML = `<img src="${url}" alt="Logo CARADEL" style="width:300px;height:300px;object-fit:contain;">`;
        centerLogo.style.display = "block";
        printableLogoDataUrl = url;
      }

      function setLogoFromDataUrl(dataUrl) {
        centerLogo.innerHTML = `<img src="${dataUrl}" alt="Logo" style="width:300px;height:300px;object-fit:contain;">`;
        centerLogo.style.display = 'block';
        printableLogoDataUrl = dataUrl;
      }

      function hideLogo() {
        centerLogo.style.display = 'none';
        printableLogoDataUrl = null;
        logoFileInput.value = '';
      }

      /* =========================================================
         ‚úÖ SUPPRESSION SIMPLE DU FOND (AUTO)
         - d√©tecte une couleur de fond en moyennant les 4 coins
         - rend transparents les pixels proches de cette couleur
         - marche bien pour fond uni (noir/blanc/gris etc.)
      ========================================================= */
      function removeBackgroundFromImage(dataUrl, opts = {}) {
        const {
          threshold = 45,     // tol√©rance (augmente si fond pas bien enlev√©)
          softEdge = 25,      // adoucit les bords (anti-cr√©nelage)
          maxSize = 900       // limite pour perf
        } = opts;

        return new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = () => {
            // Redimensionner si tr√®s grande image (perf)
            let w = img.width;
            let h = img.height;
            if (Math.max(w, h) > maxSize) {
              const scale = maxSize / Math.max(w, h);
              w = Math.round(w * scale);
              h = Math.round(h * scale);
            }

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d', { willReadFrequently: true });
            canvas.width = w;
            canvas.height = h;
            ctx.drawImage(img, 0, 0, w, h);

            const imageData = ctx.getImageData(0, 0, w, h);
            const data = imageData.data;

            // Moyenne des 4 coins (couleur de fond estim√©e)
            function getPixel(x, y) {
              const i = (y * w + x) * 4;
              return [data[i], data[i+1], data[i+2], data[i+3]];
            }

            const corners = [
              getPixel(0, 0),
              getPixel(w - 1, 0),
              getPixel(0, h - 1),
              getPixel(w - 1, h - 1)
            ];

            const bg = corners.reduce((acc, p) => {
              acc[0] += p[0]; acc[1] += p[1]; acc[2] += p[2];
              return acc;
            }, [0,0,0]).map(v => v / corners.length);

            const [bgR, bgG, bgB] = bg;

            // Enlever le fond
            for (let i = 0; i < data.length; i += 4) {
              const r = data[i], g = data[i+1], b = data[i+2];
              const dr = r - bgR, dg = g - bgG, db = b - bgB;
              const dist = Math.sqrt(dr*dr + dg*dg + db*db);

              if (dist <= threshold) {
                // Transparent complet
                data[i+3] = 0;
              } else if (dist <= threshold + softEdge) {
                // D√©grad√© pour bord plus propre
                const t = (dist - threshold) / softEdge; // 0..1
                data[i+3] = Math.round(255 * t);
              }
            }

            ctx.putImageData(imageData, 0, 0);

            // Toujours sortir en PNG (garde transparence)
            resolve(canvas.toDataURL('image/png'));
          };

          img.onerror = () => reject(new Error("Impossible de charger l'image."));
          img.src = dataUrl;
        });
      }

      // Upload logo (DataURL) + suppression fond
      logoFileInput.addEventListener('change', async function(e) {
        const file = e.target.files && e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = async function(event) {
          try {
            const originalDataUrl = event.target.result;

            // Si c'est d√©j√† un PNG transparent, on peut tenter quand m√™me (√ßa ne casse pas)
            // Tu peux ajuster threshold si besoin : 35-70 selon les logos
            const cleanedDataUrl = await removeBackgroundFromImage(originalDataUrl, {
              threshold: 50,
              softEdge: 25,
              maxSize: 900
            });

            setLogoFromDataUrl(cleanedDataUrl);
            alert("‚úÖ Logo charg√© ! Fond supprim√© automatiquement (si fond uni).");
          } catch (err) {
            // Si le traitement √©choue, on affiche l'image originale
            setLogoFromDataUrl(event.target.result);
            alert("‚ö†Ô∏è Logo charg√©, mais suppression du fond impossible. (Fond complexe ou erreur)");
          }
        };
        reader.readAsDataURL(file);
      });

      // Show default PNG logo button
      testLogoBtn.addEventListener('click', function() {
        setLogoFromUrl(defaultLogoPNG);
        alert("‚úÖ Logo CARADEL (caradel-logo.png) affich√© ! Visible √† l'√©cran et dans le PDF.");
      });

      // Hide logo
      removeLogoBtn.addEventListener('click', function() {
        hideLogo();
        alert("‚úÖ Logo cach√© !");
      });

      // Convert logo to background before print (more reliable in PDFs)
      function applyPrintLogoBackground() {
        if (!printableLogoDataUrl) return;

        centerLogo.innerHTML = "";
        centerLogo.style.display = "block";
        centerLogo.style.visibility = "visible";
        centerLogo.style.opacity = "0.12";

        centerLogo.style.width = "300px";
        centerLogo.style.height = "300px";
        centerLogo.style.backgroundImage = `url("${printableLogoDataUrl}")`;
        centerLogo.style.backgroundRepeat = "no-repeat";
        centerLogo.style.backgroundPosition = "center";
        centerLogo.style.backgroundSize = "contain";
      }

      function cleanupAfterPrint() {
        if (!printableLogoDataUrl) return;

        centerLogo.style.backgroundImage = "";
        centerLogo.style.backgroundRepeat = "";
        centerLogo.style.backgroundPosition = "";
        centerLogo.style.backgroundSize = "";

        centerLogo.innerHTML = `<img src="${printableLogoDataUrl}" alt="Logo" style="width:300px;height:300px;object-fit:contain;">`;
      }

      window.addEventListener('beforeprint', applyPrintLogoBackground);
      window.addEventListener('afterprint', cleanupAfterPrint);

      // --- CONTENU ---
      function updateDocument() {
        const genre = genreInput.value;
        const isFemme = genre === 'femme';

        // Nom
        document.querySelectorAll('#displayName, #displayName2').forEach(el => {
          el.textContent = employeeNameInput.value || 'NTOUOHOU MAXIME G√âRARD';
        });

        // Dates et poste
        document.getElementById('displayBirthDate').textContent = birthDateInput.value || '23/02/1999';
        document.getElementById('displayPoste').textContent = posteInput.value || 'PLOMBIER';
        document.getElementById('displayStartDate').textContent = startDateInput.value || '01 mars 2020';
        document.getElementById('displayEndDate').textContent = endDateInput.value || '31 mai 2025';

        // Temps de travail
        document.getElementById('displayWorkingTime').textContent =
          workingTimeInput.value || 'huit (08) heures par jour, soit quarante (40) heures par semaine';

        // Missions
        const lines = missionsInput.value.split('\n');
        let missionsHTML = '';
        lines.forEach(line => {
          let cleanLine = line.trim();
          if (cleanLine) {
            if (!cleanLine.startsWith('‚Ä¢') && !cleanLine.startsWith('-')) {
              cleanLine = '‚Ä¢ ' + cleanLine;
            }
            missionsHTML += `<li>${cleanLine.replace(/^[‚Ä¢\\-]\\s*/, '')}</li>`;
          }
        });
        document.getElementById('displayMissions').innerHTML = missionsHTML || '<li>Aucune mission sp√©cifi√©e</li>';

        // Genre
        const civilite = isFemme ? 'Madame' : 'Monsieur';
        const participe = isFemme ? 'e' : '';
        const pronom = isFemme ? 'elle' : 'il';

        document.getElementById('civilite').textContent = civilite;
        document.getElementById('civilite2').textContent = civilite;
        document.getElementById('pronoun').textContent = pronom;
        document.querySelectorAll('#feminineE, #feminineE2, #feminineE3').forEach(el => {
          el.textContent = participe;
        });
      }

      // Events live
      [employeeNameInput, birthDateInput, posteInput, startDateInput, endDateInput].forEach(input => {
        input.addEventListener('input', updateDocument);
      });
      genreInput.addEventListener('change', updateDocument);
      missionsInput.addEventListener('input', updateDocument);
      workingTimeInput.addEventListener('input', updateDocument);

      // Buttons
      document.getElementById('generateBtn').addEventListener('click', function() {
        if (!employeeNameInput.value || !birthDateInput.value || !posteInput.value || !startDateInput.value || !endDateInput.value || !workingTimeInput.value) {
          alert('Veuillez remplir tous les champs obligatoires (*)');
          return;
        }
        updateDocument();
        alert('‚úÖ Attestation g√©n√©r√©e ! Pr√™te pour le PDF.');
      });

      document.getElementById('resetBtn').addEventListener('click', function() {
        employeeNameInput.value = 'NTOUOHOU MAXIME G√âRARD';
        birthDateInput.value = '23/02/1999';
        posteInput.value = 'PLOMBIER';
        genreInput.value = 'homme';
        startDateInput.value = '01 mars 2020';
        endDateInput.value = '31 mai 2025';
        workingTimeInput.value = 'huit (08) heures par jour, soit quarante (40) heures par semaine';
        missionsInput.value = `‚Ä¢ Installation des syst√®mes de plomberie
‚Ä¢ Entretien et r√©paration des r√©seaux d'eau
‚Ä¢ D√©tection et r√©paration des fuites
‚Ä¢ Pose d'√©quipements sanitaires
‚Ä¢ Respect des normes de s√©curit√© et de qualit√©`;

        logoFileInput.value = '';
        setLogoFromUrl(defaultLogoPNG);

        updateDocument();
        alert('‚úÖ Formulaire r√©initialis√© ! Logo CARADEL (PNG) restaur√©.');
      });

      // Print / PDF
      printBtn.addEventListener('click', function() {
        if (!employeeNameInput.value || !birthDateInput.value) {
          alert("Veuillez d'abord g√©n√©rer l'attestation");
          return;
        }

        if (printableLogoDataUrl) {
          centerLogo.style.display = "block";
          centerLogo.style.visibility = "visible";
        }

        setTimeout(() => window.print(), 150);
      });

      // Init
      updateDocument();

      // Charger automatiquement le PNG par d√©faut au d√©marrage
      setLogoFromUrl(defaultLogoPNG);

      // Alerte si PNG manquant (dev)
      const imgTest = new Image();
      imgTest.onerror = () => console.warn("‚ö†Ô∏è caradel-logo.png introuvable. Mets le fichier dans le m√™me dossier que ce HTML.");
      imgTest.src = defaultLogoPNG;
    });
  </script>
</body>
</html>
