<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>G√©n√©rateur d'Attestation - CARADEL SARL</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family:"Times New Roman", serif;
    }

    body{
      background-color:#f5f5f5;
      color:#000;
      line-height:1.4;
      padding:15px;
      max-width:900px;
      margin:0 auto;
      font-size:13px;
    }

    /* Interface de contr√¥le */
    .controls{
      background-color:#fff;
      padding:15px;
      border-radius:6px;
      margin-bottom:20px;
      box-shadow:0 3px 8px rgba(0,0,0,0.08);
      border:1px solid #ddd;
    }

    .logo-control{
      background-color:#f8f9fa;
      padding:12px;
      border-radius:4px;
      margin-bottom:15px;
      border-left:3px solid #0d3b66;
    }

    .form-row{
      display:flex;
      gap:10px;
      margin-bottom:12px;
    }

    .form-col{ flex:1; }

    .form-group{ margin-bottom:10px; }

    label{
      display:block;
      margin-bottom:4px;
      font-weight:bold;
      color:#0d3b66;
      font-size:12px;
    }

    input, select, textarea{
      width:100%;
      padding:7px;
      border:1px solid #ddd;
      border-radius:3px;
      font-size:12px;
      font-family:inherit;
    }

    textarea{
      min-height:70px;
      resize:vertical;
    }

    .button-group{
      display:flex;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }

    button{
      padding:8px 16px;
      border:none;
      border-radius:3px;
      font-size:12px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:6px;
      transition:all .3s ease;
      flex:1;
    }

    .print-btn{ background:#0d3b66; color:#fff; }
    .print-btn:hover{ background:#0a2d4d; }
    .reset-btn{ background:#666; color:#fff; }
    .reset-btn:hover{ background:#555; }
    .generate-btn{ background:#2a9d8f; color:#fff; }
    .generate-btn:hover{ background:#24897c; }

    .footer{
      text-align:center;
      margin-top:15px;
      padding-top:12px;
      border-top:1px solid #ddd;
      color:#666;
      font-size:10px;
    }

    .mission-example{
      font-size:10px;
      color:#666;
      margin-top:4px;
      font-style:italic;
    }

    .logo-info{
      font-size:11px;
      color:#666;
      margin-top:8px;
      font-style:italic;
    }

    /* ATTESTATION - A4 */
    .document-container{
      background:#fff;
      padding:30px;
      margin-bottom:20px;
      box-shadow:0 0 10px rgba(0,0,0,0.1);
      position:relative;
      min-height:280mm;
      page-break-inside:avoid;
      width:210mm;
      margin-left:auto;
      margin-right:auto;
    }

    /* LOGO CENTRAL (filigrane) */
    .center-logo{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      z-index:1;
      opacity:0.15;
      pointer-events:none;
      text-align:center;
      width:300px;
      height:300px;
    }
    .center-logo img{
      width:300px;
      height:300px;
      object-fit:contain;
      display:block;
    }

    .letterhead{
      text-align:center;
      border-bottom:2px solid #0d3b66;
      padding-bottom:10px;
      margin-bottom:20px;
      position:relative;
      z-index:10;
      background:#fff;
      padding-top:10px;
    }

    .company-name{
      font-size:20px;
      font-weight:bold;
      color:#0d3b66;
      text-transform:uppercase;
      letter-spacing:1px;
      margin-bottom:3px;
    }

    .company-tagline{
      font-size:11px;
      font-style:italic;
      color:#666;
      margin-bottom:8px;
    }

    .company-details{
      font-size:10px;
      color:#333;
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:10px;
      margin-top:5px;
    }

    .content{
      font-size:13px;
      text-align:justify;
      margin-bottom:15px;
      position:relative;
      z-index:10;
    }

    .attestation-title{
      text-align:center;
      font-size:15px;
      font-weight:bold;
      text-transform:uppercase;
      margin-bottom:25px;
      text-decoration:underline;
      position:relative;
      z-index:10;
    }

    .section{
      margin-bottom:12px;
      position:relative;
      z-index:10;
    }

    .employee-info{
      margin:15px 0;
      padding:12px;
      background:rgba(249,249,249,0.95);
      border-left:3px solid #0d3b66;
      position:relative;
      z-index:10;
    }

    .info-line{ margin-bottom:4px; }

    .mission-list{
      margin:12px 0 15px 20px;
      position:relative;
      z-index:10;
    }

    .mission-list li{
      margin-bottom:5px;
      text-align:justify;
    }

    .signature-section{
      margin-top:40px;
      text-align:right;
      position:relative;
      z-index:10;
    }

    .signature-line{
      display:inline-block;
      width:220px;
      border-bottom:1px solid #000;
      margin-bottom:4px;
    }

    .date-place{
      margin-top:25px;
      text-align:right;
      font-style:italic;
      position:relative;
      z-index:10;
    }

    .stamp{
      position:absolute;
      bottom:70px;
      left:30px;
      width:90px;
      height:90px;
      border:2px dashed #0d3b66;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:.8;
      transform:rotate(-15deg);
      z-index:10;
      background:#fff;
    }

    .stamp-text{
      text-align:center;
      font-weight:bold;
      color:#0d3b66;
      font-size:10px;
      text-transform:uppercase;
      padding:4px;
    }

    /* R√àGLES D'IMPRESSION */
    @media print{
      /* Important : forcer l'impression des couleurs & backgrounds */
      *{
        -webkit-print-color-adjust:exact !important;
        print-color-adjust:exact !important;
      }

      .controls, .footer, button{ display:none !important; }

      body{
        background:#fff !important;
        padding:0 !important;
        margin:0 !important;
        width:210mm !important;
        font-size:12px !important;
      }

      .document-container{
        box-shadow:none !important;
        padding:25px !important;
        margin:0 auto !important;
        border:none !important;
        width:210mm !important;
        height:297mm !important;
        min-height:297mm !important;
        position:relative !important;
        display:block !important;
        page-break-after:always;
      }

      /* logo filigrane : on force l'affichage */
      .center-logo{
        display:block !important;
        visibility:visible !important;
        opacity:0.12 !important;
        z-index:1 !important;
      }

      .letterhead{
        border-bottom:2px solid #000 !important;
        margin-bottom:15px !important;
        padding-bottom:8px !important;
        padding-top:0 !important;
      }

      .employee-info{ background:rgba(249,249,249,0.98) !important; }

      .stamp{
        bottom:60px !important;
        left:25px !important;
      }

      .section, .employee-info, .mission-list{
        page-break-inside:avoid !important;
      }
    }

    @media (max-width:768px){
      body{ padding:10px; }
      .document-container{ padding:20px; width:auto; }
      .form-row{ flex-direction:column; gap:0; }
      .button-group{ flex-direction:column; }
      button{ width:100%; justify-content:center; }
      .stamp{
        position:relative;
        bottom:auto;
        left:auto;
        margin:20px auto;
      }
      .center-logo{ width:200px; height:200px; }
      .center-logo img{ width:200px; height:200px; }
    }
  </style>
</head>

<body>
  <!-- Interface de contr√¥le -->
  <div class="controls">
    <h3><i class="fas fa-edit"></i> Personnaliser l'attestation</h3>

    <!-- SECTION POUR LE LOGO -->
    <div class="logo-control">
      <label for="logoFile">üñºÔ∏è LOGO CENTRAL DANS L'ATTESTATION</label>
      <input type="file" id="logoFile" accept="image/*">
      <p class="logo-info"><strong>IMPORTANT :</strong> Le logo sera visible √Ä L'√âCRAN et DANS LE PDF.</p>
      <p class="logo-info">Formats accept√©s : PNG, JPG, SVG. Taille recommand√©e : 300x300 pixels.</p>

      <div style="margin-top:10px; display:flex; gap:10px;">
        <button id="testLogoBtn" style="background-color:#6c757d;">
          <i class="fas fa-image"></i> Afficher logo CARADEL
        </button>
        <button id="removeLogoBtn" style="background-color:#dc3545;">
          <i class="fas fa-times"></i> Cacher le logo
        </button>
      </div>
    </div>

    <!-- Informations du salari√© -->
    <div class="form-row">
      <div class="form-col">
        <div class="form-group">
          <label for="employeeName">Nom et pr√©nom du salari√© *</label>
          <input type="text" id="employeeName" value="NTOUOHOU MAXIME G√âRARD" required>
        </div>
        <div class="form-group">
          <label for="birthDate">Date de naissance *</label>
          <input type="text" id="birthDate" value="23/02/1999" required>
        </div>
        <div class="form-group">
          <label for="poste">Poste occup√© *</label>
          <input type="text" id="poste" value="PLOMBIER" required>
        </div>
      </div>

      <div class="form-col">
        <div class="form-group">
          <label for="genre">Genre du salari√© *</label>
          <select id="genre">
            <option value="homme">Homme</option>
            <option value="femme">Femme</option>
          </select>
        </div>
        <div class="form-group">
          <label for="startDate">Date de d√©but *</label>
          <input type="text" id="startDate" value="01 mars 2020" required>
        </div>
        <div class="form-group">
          <label for="endDate">Date de fin *</label>
          <input type="text" id="endDate" value="31 mai 2025" required>
        </div>
      </div>
    </div>

    <!-- ‚úÖ NOUVEAU : Temps de travail -->
    <div class="form-group">
      <label for="workingTime">Temps de travail *</label>
      <input
        type="text"
        id="workingTime"
        value="huit (08) heures par jour, soit quarante (40) heures par semaine"
        required
      >
      <div class="mission-example">
        Exemple : huit (08) heures par jour, soit quarante (40) heures par semaine
      </div>
    </div>

    <!-- Missions -->
    <div class="form-group">
      <label for="missions">Missions (une par ligne, avec ‚Ä¢ au d√©but)</label>
      <textarea id="missions" class="missions-input">‚Ä¢ Installation des syst√®mes de plomberie
‚Ä¢ Entretien et r√©paration des r√©seaux d'eau
‚Ä¢ D√©tection et r√©paration des fuites
‚Ä¢ Pose d'√©quipements sanitaires
‚Ä¢ Respect des normes de s√©curit√© et de qualit√©</textarea>
      <div class="mission-example">Exemple: ‚Ä¢ Mission 1 ‚Ä¢ Mission 2 (une par ligne)</div>
    </div>

    <!-- Boutons -->
    <div class="button-group">
      <button class="generate-btn" id="generateBtn">
        <i class="fas fa-file-contract"></i> G√©n√©rer l'attestation
      </button>
      <button class="reset-btn" id="resetBtn">
        <i class="fas fa-redo"></i> R√©initialiser
      </button>
      <button class="print-btn" id="printBtn">
        <i class="fas fa-print"></i> G√©n√©rer PDF
      </button>
    </div>
  </div>

  <!-- ATTESTATION -->
  <div class="document-container" id="documentContainer">
    <!-- LOGO CENTRAL -->
    <div class="center-logo" id="centerLogo"></div>

    <!-- Contenu -->
    <div class="letterhead">
      <div class="company-name">CARADEL SARL</div>
      <div class="company-tagline">Une Entreprise au service de tous</div>
      <div class="company-details">
        <div>RC/DSC/2022/B/18</div>
        <div>NIU: M012217028223S</div>
        <div>T√©l: 696 67 15 13</div>
        <div>Dschang-Cameroun</div>
        <div>Email: caradel2020@gmail.com</div>
      </div>
    </div>

    <h1 class="attestation-title">ATTESTATION DE TRAVAIL</h1>

    <div class="content" id="documentContent">
      <div class="section">
        <p>Je soussign√©, <strong>Monsieur NDONGSON LEKANE Barthelemy</strong>,</p>
        <p>agissant en qualit√© de <strong>Directeur</strong>,</p>
        <p>au sein de l'entreprise <strong>CARADEL SARL</strong>,</p>
        <p>situ√©e √† <strong>Dschang, Cameroun</strong>,</p>
      </div>

      <div class="section">
        <p>atteste par la pr√©sente que :</p>
      </div>

      <div class="employee-info">
        <div class="info-line" id="salarieLine">
          <strong><span id="civilite">Monsieur</span> <span id="displayName">NTOUOHOU MAXIME G√âRARD</span></strong>,
        </div>
        <div class="info-line" id="naissanceLine">
          n√©<span id="feminineE"></span> le <span id="displayBirthDate">23/02/1999</span>,
        </div>
        <div class="info-line">
          a √©t√© employ√©<span id="feminineE2"></span> au sein de notre entreprise en qualit√© de
          <strong><span id="displayPoste">PLOMBIER</span></strong>,
        </div>
        <div class="info-line">
          du <span id="displayStartDate">01 mars 2020</span> au <span id="displayEndDate">31 mai 2025</span>.
        </div>

        <!-- ‚úÖ NOUVEAU : Temps de travail affich√© dans l'attestation -->
        <div class="info-line">
          travaillait √† raison de <strong><span id="displayWorkingTime">huit (08) heures par jour, soit quarante (40) heures par semaine</span></strong>,
          conform√©ment √† la r√©glementation en vigueur.
        </div>
      </div>

      <div class="section">
        <p>Durant cette p√©riode, <span id="pronoun">il</span> a assur√© notamment les missions suivantes :</p>
        <ul class="mission-list" id="displayMissions">
          <li>Installation des syst√®mes de plomberie</li>
          <li>Entretien et r√©paration des r√©seaux d'eau</li>
          <li>D√©tection et r√©paration des fuites</li>
          <li>Pose d'√©quipements sanitaires</li>
          <li>Respect des normes de s√©curit√© et de qualit√©</li>
        </ul>
      </div>

      <div class="section">
        <p><span id="civilite2">Monsieur</span> <span id="displayName2">NTOUOHOU MAXIME G√âRARD</span> s'est distingu√©<span id="feminineE3"></span> par son s√©rieux, son professionnalisme et la qualit√© de son travail.</p>
      </div>

      <div class="section">
        <p>La pr√©sente attestation est d√©livr√©e pour servir et valoir ce que de droit.</p>
      </div>

      <div class="date-place">
        <p>Fait √† Dschang, le <span id="currentDate">15 novembre 2023</span></p>
      </div>
    </div>

    <div class="signature-section">
      <div class="signature-line"></div>
      <p><strong>Monsieur NDONGSON LEKANE Barthelemy</strong></p>
      <p><strong>Directeur</strong></p>
      <p><strong>CARADEL SARL</strong></p>
    </div>

    <div class="stamp">
      <div class="stamp-text">Cachet<br>de<br>l'entreprise</div>
    </div>
  </div>

  <div class="footer">
    <p>CARADEL SARL - RC/DSC/2022/B/18 - NIU: M012217028223S - T√©l: 696 67 15 13 - Dschang-Cameroun</p>
    <p>G√©n√©rateur d'attestation de travail - Logo visible dans le PDF</p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Date auto
      const now = new Date();
      const options = { day: 'numeric', month: 'long', year: 'numeric' };
      document.getElementById('currentDate').textContent = now.toLocaleDateString('fr-FR', options);

      // Inputs
      const employeeNameInput = document.getElementById('employeeName');
      const birthDateInput = document.getElementById('birthDate');
      const posteInput = document.getElementById('poste');
      const genreInput = document.getElementById('genre');
      const startDateInput = document.getElementById('startDate');
      const endDateInput = document.getElementById('endDate');
      const missionsInput = document.getElementById('missions');

      // ‚úÖ NOUVEAU : temps de travail
      const workingTimeInput = document.getElementById('workingTime');

      // Logo elements
      const logoFileInput = document.getElementById('logoFile');
      const centerLogo = document.getElementById('centerLogo');
      const testLogoBtn = document.getElementById('testLogoBtn');
      const removeLogoBtn = document.getElementById('removeLogoBtn');
      const printBtn = document.getElementById('printBtn');

      // SVG default
      const defaultLogoSVG = `
        <svg xmlns="http://www.w3.org/2000/svg" width="300" height="300" viewBox="0 0 300 300">
          <rect width="300" height="300" fill="#0d3b66" opacity="0.08"/>
          <circle cx="150" cy="150" r="120" fill="#2a9d8f" opacity="0.1"/>
          <text x="150" y="130" text-anchor="middle" font-size="42" fill="#0d3b66"
                font-family="Arial, sans-serif" font-weight="bold">CARADEL</text>
          <text x="150" y="180" text-anchor="middle" font-size="36" fill="#2a9d8f"
                font-family="Arial, sans-serif" font-weight="bold">SARL</text>
          <text x="150" y="230" text-anchor="middle" font-size="20" fill="#666"
                font-family="Arial, sans-serif">Entreprise de Services</text>
        </svg>
      `;

      // --- LOGO PRINT SAFE ---
      let printableLogoDataUrl = null;

      function svgToDataUrl(svg) {
        const cleaned = svg.replace(/\s+/g, ' ').trim();
        return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(cleaned);
      }

      function setLogoFromDataUrl(dataUrl) {
        centerLogo.innerHTML = `<img src="${dataUrl}" alt="Logo" style="width:300px;height:300px;object-fit:contain;">`;
        centerLogo.style.display = 'block';
        printableLogoDataUrl = dataUrl;
      }

      function setLogoFromInlineSVG(svg) {
        centerLogo.innerHTML = svg; // √©cran
        centerLogo.style.display = 'block';
        printableLogoDataUrl = svgToDataUrl(svg); // impression
      }

      function hideLogo() {
        centerLogo.style.display = 'none';
        printableLogoDataUrl = null;
        logoFileInput.value = '';
      }

      // Upload logo
      logoFileInput.addEventListener('change', function(e) {
        const file = e.target.files && e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
          setLogoFromDataUrl(event.target.result);
          alert("‚úÖ Logo t√©l√©charg√© ! Visible √† l'√©cran et dans le PDF.");
        };
        reader.readAsDataURL(file);
      });

      // Show default logo
      testLogoBtn.addEventListener('click', function() {
        setLogoFromInlineSVG(defaultLogoSVG);
        alert("‚úÖ Logo CARADEL affich√© ! Visible √† l'√©cran et dans le PDF.");
      });

      // Hide logo
      removeLogoBtn.addEventListener('click', function() {
        hideLogo();
        alert("‚úÖ Logo cach√© !");
      });

      // Convert logo to background before print (more reliable in PDFs)
      function applyPrintLogoBackground() {
        if (!printableLogoDataUrl) return;

        centerLogo.innerHTML = "";
        centerLogo.style.display = "block";
        centerLogo.style.visibility = "visible";
        centerLogo.style.opacity = "0.12";

        centerLogo.style.width = "300px";
        centerLogo.style.height = "300px";
        centerLogo.style.backgroundImage = `url("${printableLogoDataUrl}")`;
        centerLogo.style.backgroundRepeat = "no-repeat";
        centerLogo.style.backgroundPosition = "center";
        centerLogo.style.backgroundSize = "contain";
      }

      function cleanupAfterPrint() {
        if (!printableLogoDataUrl) return;

        centerLogo.style.backgroundImage = "";
        centerLogo.style.backgroundRepeat = "";
        centerLogo.style.backgroundPosition = "";
        centerLogo.style.backgroundSize = "";

        // remettre une image pour l'√©cran (stable)
        centerLogo.innerHTML = `<img src="${printableLogoDataUrl}" alt="Logo" style="width:300px;height:300px;object-fit:contain;">`;
      }

      window.addEventListener('beforeprint', applyPrintLogoBackground);
      window.addEventListener('afterprint', cleanupAfterPrint);

      // --- CONTENU ---
      function updateDocument() {
        const genre = genreInput.value;
        const isFemme = genre === 'femme';

        // Nom
        document.querySelectorAll('#displayName, #displayName2').forEach(el => {
          el.textContent = employeeNameInput.value || 'NTOUOHOU MAXIME G√âRARD';
        });

        // Dates et poste
        document.getElementById('displayBirthDate').textContent = birthDateInput.value || '23/02/1999';
        document.getElementById('displayPoste').textContent = posteInput.value || 'PLOMBIER';
        document.getElementById('displayStartDate').textContent = startDateInput.value || '01 mars 2020';
        document.getElementById('displayEndDate').textContent = endDateInput.value || '31 mai 2025';

        // ‚úÖ Temps de travail
        document.getElementById('displayWorkingTime').textContent =
          workingTimeInput.value || 'huit (08) heures par jour, soit quarante (40) heures par semaine';

        // Missions
        const lines = missionsInput.value.split('\n');
        let missionsHTML = '';
        lines.forEach(line => {
          let cleanLine = line.trim();
          if (cleanLine) {
            if (!cleanLine.startsWith('‚Ä¢') && !cleanLine.startsWith('-')) {
              cleanLine = '‚Ä¢ ' + cleanLine;
            }
            missionsHTML += `<li>${cleanLine.replace(/^[‚Ä¢\\-]\\s*/, '')}</li>`;
          }
        });
        document.getElementById('displayMissions').innerHTML = missionsHTML || '<li>Aucune mission sp√©cifi√©e</li>';

        // Genre
        const civilite = isFemme ? 'Madame' : 'Monsieur';
        const participe = isFemme ? 'e' : '';
        const pronom = isFemme ? 'elle' : 'il';

        document.getElementById('civilite').textContent = civilite;
        document.getElementById('civilite2').textContent = civilite;
        document.getElementById('pronoun').textContent = pronom;
        document.querySelectorAll('#feminineE, #feminineE2, #feminineE3').forEach(el => {
          el.textContent = participe;
        });
      }

      // Events live
      [employeeNameInput, birthDateInput, posteInput, startDateInput, endDateInput].forEach(input => {
        input.addEventListener('input', updateDocument);
      });
      genreInput.addEventListener('change', updateDocument);
      missionsInput.addEventListener('input', updateDocument);

      // ‚úÖ Live update temps de travail
      workingTimeInput.addEventListener('input', updateDocument);

      // Buttons
      document.getElementById('generateBtn').addEventListener('click', function() {
        if (!employeeNameInput.value || !birthDateInput.value || !posteInput.value || !startDateInput.value || !endDateInput.value || !workingTimeInput.value) {
          alert('Veuillez remplir tous les champs obligatoires (*)');
          return;
        }
        updateDocument();
        alert('‚úÖ Attestation g√©n√©r√©e ! Pr√™te pour le PDF.');
      });

      document.getElementById('resetBtn').addEventListener('click', function() {
        employeeNameInput.value = 'NTOUOHOU MAXIME G√âRARD';
        birthDateInput.value = '23/02/1999';
        posteInput.value = 'PLOMBIER';
        genreInput.value = 'homme';
        startDateInput.value = '01 mars 2020';
        endDateInput.value = '31 mai 2025';
        workingTimeInput.value = 'huit (08) heures par jour, soit quarante (40) heures par semaine';
        missionsInput.value = `‚Ä¢ Installation des syst√®mes de plomberie
‚Ä¢ Entretien et r√©paration des r√©seaux d'eau
‚Ä¢ D√©tection et r√©paration des fuites
‚Ä¢ Pose d'√©quipements sanitaires
‚Ä¢ Respect des normes de s√©curit√© et de qualit√©`;

        logoFileInput.value = '';
        setLogoFromInlineSVG(defaultLogoSVG);

        updateDocument();
        alert('‚úÖ Formulaire r√©initialis√© ! Logo CARADEL restaur√©.');
      });

      // Print / PDF
      printBtn.addEventListener('click', function() {
        if (!employeeNameInput.value || !birthDateInput.value) {
          alert("Veuillez d'abord g√©n√©rer l'attestation");
          return;
        }

        // Forcer visible avant impression
        if (printableLogoDataUrl) {
          centerLogo.style.display = "block";
          centerLogo.style.visibility = "visible";
        }

        // petit d√©lai
        setTimeout(() => window.print(), 150);
      });

      // Init
      updateDocument();
      setLogoFromInlineSVG(defaultLogoSVG);
    });
  </script>
</body>
</html>
